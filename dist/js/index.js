var dataList,len,control,timer,deg,root=window.player,audio=root.audioManager,duration=0;function getData(o){$.ajax({type:"GET",url:o,success:function(o){len=o.length,control=new root.controlIndex(len),dataList=o,root.render(o[0]),audio.getAudio(o[0].audio),root.pro.renderAllTime(o[0].duration),duration=o[0].duration,bindEvent(),bindTouchEvent(),$(".wrapper ul li").eq(0).css({color:"#00cc66"})},error:function(){}})}function bindEvent(){$("body").on("play:change",function(o,t){audio.getAudio(dataList[t].audio),root.render(dataList[t]),root.pro.renderAllTime(dataList[t].duration),duration=dataList[t].duration,$(".wrapper ul li").css({color:"#fff"}),$(".wrapper ul li").eq(t).css({color:"#00cc66"}),"play"==audio.status?(audio.play(),root.pro.start(),rotated(0)):root.pro.upDate(0),$(".img-box").attr("data-deg",0),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"})}),$(".like").on("click",function(){$(".like").toggleClass("liking")}),$(".prev").on("click",function(){var o=control.prev();$("body").trigger("play:change",o),audio.status="play",audio.play(),root.pro.start(),rotated(0),$(".play").addClass("playing")}),$(".next").on("click",function(){var o=control.next();$("body").trigger("play:change",o),audio.status="play",audio.play(),root.pro.start(),rotated(0),$(".play").addClass("playing")}),$(".play").on("click",function(){"pause"==audio.status?(audio.play(),root.pro.start(),rotated(deg=$(".img-box").attr("data-deg"))):(audio.pause(),root.pro.stop(),clearInterval(timer)),$(".play").toggleClass("playing")}),$(".list").on("click",function(){$(".wrapper ul").show()}),$(".wrapper").append("<ul></ul>");for(var o=0;o<len;o++)$(".wrapper ul").append("<li>"+dataList[o].song+" - "+dataList[o].singer+"</li>");$(".wrapper ul").append("<div>关闭</div>"),$(".wrapper ul").prepend("<p>播放列表</p>"),$(".wrapper ul").css({width:"100%",height:"30%","font-size":"14px",color:"#fff",overflow:"scroll","max-height":"30%",background:"black",position:"absolute",bottom:"0px",display:"none",opacity:"0.8"}),$(".wrapper ul li").css({"margin-top":"7px","margin-left":"7px","border-bottom":"1px solid #eee"}),$(".wrapper ul li").eq(0).css({"margin-top":"32px"}),$(".wrapper ul p").css({width:"100%",height:"24px",color:"#fff","font-size":"18px","margin-bottom":"7px","margin-top":"7px","text-align":"center",position:"absolute",top:"0px"}),$(".wrapper ul div").css({width:"100%",color:"#fff","margin-bottom":"7px","padding-top":"7px","padding-bottom":"7px","text-align":"center",position:"absolute",bottom:"0px"}),$(".wrapper ul div").on("click",function(){$(".wrapper ul").hide()}),$(".wrapper ul li").each(function(o,t){$(t).on("click",function(){audio.getAudio(dataList[o].audio),root.render(dataList[o]),root.pro.renderAllTime(dataList[o].duration),audio.status="play",$(".play").addClass("playing"),$(".wrapper ul li").css({color:"#fff"}),$(".wrapper ul li").eq(o).css({color:"#00cc66"}),audio.play(),root.pro.start(),rotated(0),$(".img-box").attr("data-deg",0),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"})})})}function bindTouchEvent(){var r=$(".pro-bottom").offset().left,i=$(".pro-bottom").offset().width;$(".spot").on("touchstart",function(o){root.pro.stop()}).on("touchmove",function(o){var t=(o.changedTouches[0].clientX-r)/i;0<=t&&t<1&&root.pro.upDate(t)}).on("touchend",function(o){var t=(o.changedTouches[0].clientX-r)/i,a=t*duration;0<=t&&t<1&&(audio.playTo(a),audio.play(),root.pro.start(t),$(".play").addClass("playing"))})}function rotated(o){clearInterval(timer),o=+o,timer=setInterval(function(){o+=2,$(".img-box").attr("data-deg",o),$(".img-box").css({transform:"rotateZ("+o+"deg)",transition:"all 1s ease-out"})},200)}$(audio.audio).on("ended",function(){$(".next").trigger("click")}),getData("../mock/data.json");